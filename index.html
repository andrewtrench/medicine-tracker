<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medication Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #4285f4;
            margin-bottom: 20px;
        }
        .time-slot {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .time-header {
            background-color: #4285f4;
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 16px;
        }
        .medication {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        .medication:last-child {
            border-bottom: none;
        }
        .medication input {
            margin-right: 15px;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        .medication.completed .med-name {
            text-decoration: line-through;
            color: #999;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            display: none;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .med-info {
            flex-grow: 1;
            cursor: pointer;
        }
        .med-name {
            font-weight: bold;
        }
        .med-instructions {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }
        .debug-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0,0,0,0.6);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            font-weight: bold;
            z-index: 100;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        /* Add simple animation for when medications are checked */
        @keyframes checkPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: checkPulse 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <h1>Medication Tracker</h1>

    <div id="medication-list">
        <!-- Medications will be populated here -->
    </div>

    <div id="toast" class="toast">Message</div>
    <div class="debug-btn" id="debug-btn">?</div>

    <script>
        // Debug alert to see if script loads
        console.log("Script started");

        // Complete medication data from your schedule
        const medicationData = [
            {
                timeSlot: "6:30 AM (Before Breakfast)",
                medications: [
                    { name: "Clopamon", instructions: "" },
                    { name: "Ondansetron", instructions: "" }
                ]
            },
            {
                timeSlot: "7:00 AM (After Breakfast)",
                medications: [
                    { name: "Targinact x2", instructions: "" },
                    { name: "Xeloda", instructions: "" },
                    { name: "Losaar", instructions: "Only if BP is up" },
                    { name: "Amlodipine", instructions: "Only if BP is up" }
                ]
            },
            {
                timeSlot: "10:00 AM (Mid-Morning)",
                medications: [
                    { name: "Oxynorm", instructions: "2 tablets" },
                    { name: "Paracetamol", instructions: "" }
                ]
            },
            {
                timeSlot: "12:30 PM (Before Lunch)",
                medications: [
                    { name: "Clopamon", instructions: "Anti nausea" },
                    { name: "Ondansetron", instructions: "Anti nausea" }
                ]
            },
            {
                timeSlot: "12:30 PM",
                medications: [
                    { name: "Lenamet", instructions: "Stops stomach acid" }
                ]
            },
            {
                timeSlot: "3:00 PM (Afternoon)",
                medications: [
                    { name: "Oxynorm", instructions: "" },
                    { name: "Paracetamol", instructions: "" }
                ]
            },
            {
                timeSlot: "6:30 PM (Before Dinner)",
                medications: [
                    { name: "Clopamon", instructions: "" },
                    { name: "Ondansetron", instructions: "" }
                ]
            },
            {
                timeSlot: "7:00 PM (Dinner)",
                medications: [
                    { name: "Targinact", instructions: "" },
                    { name: "Xeloda", instructions: "" },
                    { name: "Adco-Simvastatin", instructions: "" }
                ]
            },
            {
                timeSlot: "9:00 PM (Night)",
                medications: [
                    { name: "Oxynorm", instructions: "" },
                    { name: "Paracetamol", instructions: "" }
                ]
            },
            {
                timeSlot: "10:00 PM (Before Bed)",
                medications: [
                    { name: "Movicol", instructions: "" },
                    { name: "Lenamet", instructions: "" }
                ]
            }
        ];

        // DOM Elements
        const medicationList = document.getElementById('medication-list');
        const toast = document.getElementById('toast');
        const debugBtn = document.getElementById('debug-btn');

        // Today's date for storage key
        const today = new Date().toISOString().split('T')[0];

        // Initialize
        function init() {
            renderMedications();
            addDebugButton();
        }

        // Add debug button functionality
        function addDebugButton() {
            debugBtn.addEventListener('click', function() {
                // Show debug info
                let info = "Debug Info:\n";
                info += "- Script is running\n";
                info += "- Today's date: " + today + "\n";
                info += "- localStorage available: " + (typeof localStorage !== 'undefined') + "\n";

                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    info += "- localStorage working: Yes\n";
                } catch (e) {
                    info += "- localStorage working: No (" + e.message + ")\n";
                }

                // Show taken medications
                try {
                    const stored = localStorage.getItem('taken_' + today);
                    if (stored) {
                        const takenMeds = JSON.parse(stored);
                        info += "- Medications tracked today: " + Object.keys(takenMeds).length + "\n";
                    } else {
                        info += "- Medications tracked today: None\n";
                    }
                } catch (e) {
                    info += "- Error reading medications: " + e.message + "\n";
                }

                alert(info);
            });
        }

        // Render medication list
        function renderMedications() {
            medicationList.innerHTML = '';

            // Get taken medications from storage
            let takenMeds = {};
            try {
                const stored = localStorage.getItem('taken_' + today);
                if (stored) {
                    takenMeds = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading from storage:', e);
                // Show error visibly
                showToast('Error: ' + e.message);
            }

            // Create medication list
            medicationData.forEach(slot => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';

                // Time header
                const timeHeader = document.createElement('div');
                timeHeader.className = 'time-header';
                timeHeader.textContent = slot.timeSlot;
                timeSlot.appendChild(timeHeader);

                // Medications in this time slot
                slot.medications.forEach(med => {
                    const medId = `${slot.timeSlot}-${med.name}`;
                    const isTaken = takenMeds[medId] === true;

                    const medElement = document.createElement('div');
                    medElement.className = 'medication';
                    if (isTaken) {
                        medElement.className += ' completed';
                    }

                    medElement.innerHTML = `
                        <input type="checkbox" id="${medId}" ${isTaken ? 'checked' : ''}>
                        <div class="med-info">
                            <div class="med-name">${med.name}</div>
                            ${med.instructions ? `<div class="med-instructions">${med.instructions}</div>` : ''}
                        </div>
                    `;

                    timeSlot.appendChild(medElement);

                    // Add event listeners
                    const checkbox = medElement.querySelector('input');
                    const medInfo = medElement.querySelector('.med-info');

                    // Make med-info div clickable
                    medInfo.addEventListener('click', function() {
                        checkbox.checked = !checkbox.checked;
                        handleCheckboxChange(checkbox, medId, med.name, medElement);
                    });

                    // Handle checkbox change
                    checkbox.addEventListener('change', function() {
                        handleCheckboxChange(this, medId, med.name, medElement);
                    });
                });

                medicationList.appendChild(timeSlot);
            });
        }

        // Handle checkbox changes
        function handleCheckboxChange(checkbox, medId, medName, element) {
            try {
                // Get current data
                let takenMeds = {};
                const stored = localStorage.getItem('taken_' + today);
                if (stored) {
                    takenMeds = JSON.parse(stored);
                }

                // Update data
                takenMeds[medId] = checkbox.checked;
                localStorage.setItem('taken_' + today, JSON.stringify(takenMeds));

                // Add animation
                element.classList.add('pulse');
                setTimeout(function() {
                    element.classList.remove('pulse');
                }, 300);

                // Update UI
                if (checkbox.checked) {
                    element.classList.add('completed');
                    showToast(medName + " marked as taken!");
                } else {
                    element.classList.remove('completed');
                    showToast(medName + " marked as not taken!");
                }
            } catch (e) {
                console.error('Error saving to storage:', e);
                showToast('Error saving: ' + e.message);
            }
        }

        // Show toast message
        function showToast(message) {
            toast.textContent = message;
            toast.style.display = 'block';

            setTimeout(function() {
                toast.style.display = 'none';
            }, 2000);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>