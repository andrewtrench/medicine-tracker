<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Medication Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #4285f4;
        }
        .time-slot {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .time-header {
            background-color: #4285f4;
            color: white;
            padding: 10px;
            font-weight: bold;
        }
        .medication {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        .medication:last-child {
            border-bottom: none;
        }
        .medication input {
            margin-right: 15px;
            width: 24px;
            height: 24px;
        }
        .medication.completed .med-name {
            text-decoration: line-through;
            color: #999;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: none;
        }
        .med-info {
            flex-grow: 1;
        }
        .med-name {
            font-weight: bold;
        }
        .med-instructions {
            font-size: 0.8em;
            color: #666;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <h1>Medication Tracker</h1>

    <div id="medication-list">
        <!-- Medications will be populated here -->
    </div>

    <div id="toast" class="toast">Message</div>

    <script>
        // Sample medication data
        const medicationData = [
            {
                timeSlot: "6:30 AM (Before Breakfast)",
                medications: [
                    { name: "Clopamon", instructions: "" },
                    { name: "Ondansetron", instructions: "" }
                ]
            },
            {
                timeSlot: "7:00 AM (After Breakfast)",
                medications: [
                    { name: "Targinact x2", instructions: "" },
                    { name: "Xeloda", instructions: "" },
                    { name: "Losaar", instructions: "Only if BP is up" }
                ]
            },
            {
                timeSlot: "10:00 AM (Mid-Morning)",
                medications: [
                    { name: "Oxynorm", instructions: "2 tablets" },
                    { name: "Paracetamol", instructions: "" }
                ]
            }
        ];

        // DOM Elements
        const medicationList = document.getElementById('medication-list');
        const toast = document.getElementById('toast');

        // Today's date for storage key
        const today = new Date().toISOString().split('T')[0];

        // Initialize
        function init() {
            renderMedications();
        }

        // Render medication list
        function renderMedications() {
            medicationList.innerHTML = '';

            // Get taken medications from storage
            let takenMeds = {};
            try {
                const stored = localStorage.getItem('taken_' + today);
                if (stored) {
                    takenMeds = JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading from storage:', e);
            }

            // Create medication list
            medicationData.forEach(slot => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';

                // Time header
                const timeHeader = document.createElement('div');
                timeHeader.className = 'time-header';
                timeHeader.textContent = slot.timeSlot;
                timeSlot.appendChild(timeHeader);

                // Medications in this time slot
                slot.medications.forEach(med => {
                    const medId = `${slot.timeSlot}-${med.name}`;
                    const isTaken = takenMeds[medId] === true;

                    const medElement = document.createElement('div');
                    medElement.className = 'medication';
                    if (isTaken) {
                        medElement.className += ' completed';
                    }

                    medElement.innerHTML = `
                        <input type="checkbox" id="${medId}" ${isTaken ? 'checked' : ''}>
                        <div class="med-info">
                            <div class="med-name">${med.name}</div>
                            ${med.instructions ? `<div class="med-instructions">${med.instructions}</div>` : ''}
                        </div>
                    `;

                    timeSlot.appendChild(medElement);

                    // Add event listeners
                    const checkbox = medElement.querySelector('input');

                    // Make row clickable
                    medElement.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.checked = !checkbox.checked;
                            handleCheckboxChange(checkbox, medId, med.name, medElement);
                        }
                    });

                    // Handle checkbox change
                    checkbox.addEventListener('change', function() {
                        handleCheckboxChange(this, medId, med.name, medElement);
                    });
                });

                medicationList.appendChild(timeSlot);
            });
        }

        // Handle checkbox changes
        function handleCheckboxChange(checkbox, medId, medName, element) {
            try {
                // Get current data
                let takenMeds = {};
                const stored = localStorage.getItem('taken_' + today);
                if (stored) {
                    takenMeds = JSON.parse(stored);
                }

                // Update data
                takenMeds[medId] = checkbox.checked;
                localStorage.setItem('taken_' + today, JSON.stringify(takenMeds));

                // Update UI
                if (checkbox.checked) {
                    element.classList.add('completed');
                    showToast(medName + " marked as taken!");
                } else {
                    element.classList.remove('completed');
                    showToast(medName + " marked as not taken!");
                }
            } catch (e) {
                console.error('Error saving to storage:', e);
                alert('Error saving: ' + e.message);
            }
        }

        // Show toast message
        function showToast(message) {
            toast.textContent = message;
            toast.style.display = 'block';

            setTimeout(function() {
                toast.style.display = 'none';
            }, 2000);
        }

        // Initialize the app
        init();
    </script>
</body>
</html>